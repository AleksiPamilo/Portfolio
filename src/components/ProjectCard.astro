---
import type { CollectionEntry } from 'astro:content';

interface Props {
  project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;
const { title, description, image, techStack, repoUrl } = project.data;
---

<article class="group py-4 px-8 bg-zinc-900/60 rounded-md">
  <div class:list={[
    "grid items-center gap-8",
    image ? "grid-cols-1 lg:grid-cols-5" : "grid-cols-1"
  ]}>
    
    {image && (
      <div class="lg:col-span-2">
        <button 
          class="zoom-trigger w-full cursor-zoom-in focus:outline-none text-left"
          aria-label={`Enlarge ${title} image`}
        >
          <div class="aspect-video rounded-lg overflow-hidden bg-zinc-900 border border-zinc-800/50 relative">
            <img 
              src={image} 
              alt={title}
              class="w-full h-full object-cover opacity-90 group-hover:opacity-100 group-hover:scale-[1.02] transition-all duration-500 ease-in-out"
              loading="lazy"
            />
            <div class="absolute inset-0 ring-1 ring-inset ring-white/5 rounded-lg pointer-events-none"></div>
          </div>
        </button>
      </div>
    )}

    <div class:list={[
      "flex flex-col justify-center py-2",
      image ? "lg:col-span-3" : "" 
    ]}>
      <div class="flex items-start justify-between gap-4 mb-3">
        <h3 class="text-base font-medium text-zinc-100 group-hover:text-indigo-400 transition-colors">
          {title}
        </h3>

        {repoUrl && (
          <a href={repoUrl} target="_blank" rel="noopener noreferrer" class="text-zinc-500 hover:text-zinc-200 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
          </a>
        )}
      </div>

      <p class:list={[
        "text-[14px] text-zinc-400 leading-relaxed",
        image ? "" : "max-w-3xl"
      ]}>
        {description}
      </p>

      <div class="flex flex-wrap justify-end gap-2 mt-5">
        {techStack.map(tech => (
          <span class="px-2 py-0.5 text-[11px] font-mono bg-zinc-800 border border-zinc-800/50 text-zinc-400 rounded group-hover:border-zinc-700/50 group-hover:text-zinc-300 transition-all duration-300 cursor-default">
            {tech}
          </span>
        ))}
      </div>
    </div>
  </div>

  {image && (
    <dialog class="zoom-modal p-0 bg-transparent backdrop:bg-zinc-950/90 backdrop:backdrop-blur-sm cursor-zoom-out">
      <div class="flex items-center justify-center w-screen h-screen p-4 md:p-12">
        <img 
          src={image} 
          alt={title}
          class="max-w-full max-h-full object-contain rounded-md shadow-2xl"
        />
      </div>
    </dialog>
  )}
</article>

<script>
  const cards = document.querySelectorAll('article');

  cards.forEach(card => {
    const trigger = card.querySelector('.zoom-trigger');
    const modal = card.querySelector('.zoom-modal') as HTMLDialogElement;

    if (trigger && modal) {
      trigger.addEventListener('click', () => modal.showModal());
      modal.addEventListener('click', () => modal.close());
    }
  });
</script>

<style>
  dialog {
    border: none;
    max-width: none;
    max-height: none;
  }

  dialog[open] {
    animation: fadeIn 0.2s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>