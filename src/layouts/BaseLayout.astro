---
import '../styles/global.css';

interface Props {
    title?: string;
}

const { title = "Portfolio" } = Astro.props;
---

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="viewport" content="width=device-width" />
        <meta name="generator" content={Astro.generator} />
        <title>{title}</title>
        <script is:inline>
            (() => {
                const key = 'portfolio-theme';
                const savedTheme = localStorage.getItem(key);
                const preferred = window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
                document.documentElement.dataset.theme = savedTheme ?? preferred;
            })();
        </script>
    </head>
    <body class="site-body">
        <button class="theme-toggle" id="theme-toggle" type="button" aria-label="Toggle theme">
            <span class="theme-toggle__icon" id="theme-icon">◐</span>
            <span class="theme-toggle__text" id="theme-label">Theme</span>
        </button>
        <slot />

        <script is:inline>
            (() => {
                const root = document.documentElement;
                const themeButton = document.getElementById('theme-toggle');
                const icon = document.getElementById('theme-icon');
                const label = document.getElementById('theme-label');
                const key = 'portfolio-theme';

                const setTheme = (theme) => {
                    root.dataset.theme = theme;
                    localStorage.setItem(key, theme);
                    if (icon) icon.textContent = theme === 'light' ? '☀︎' : '☾';
                    if (label) label.textContent = theme === 'light' ? 'Light' : 'Dark';
                };

                themeButton?.addEventListener('click', () => {
                    const nextTheme = root.dataset.theme === 'light' ? 'dark' : 'light';
                    setTheme(nextTheme);
                });

                setTheme(root.dataset.theme === 'light' ? 'light' : 'dark');

                const revealElements = Array.from(document.querySelectorAll('.reveal'));
                if (revealElements.length > 0) {
                    const observer = new IntersectionObserver(
                        (entries, instance) => {
                            entries.forEach((entry) => {
                                if (entry.isIntersecting) {
                                    entry.target.classList.add('is-visible');
                                    instance.unobserve(entry.target);
                                }
                            });
                        },
                        { threshold: 0.14, rootMargin: '0px 0px -6% 0px' }
                    );

                    revealElements.forEach((element, index) => {
                        element.style.setProperty('--reveal-delay', `${Math.min(index * 50, 280)}ms`);
                        observer.observe(element);
                    });
                }
            })();
        </script>
    </body>
</html>